{%- style -%}
.section-{{ section.id }}-padding {
  padding-top: {{ section.settings.padding_top | times: 0.50 | round: 0 }}px;
  padding-bottom: {{ section.settings.padding_bottom | times: 0.50 | round: 0 }}px;
}
@media screen and (min-width: 576px) and (max-width: 749px){
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }
}
@media screen and (min-width: 750px) {
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
  }
}
{%- endstyle -%}

<div class="video-popup-container section-{{ section.id }}-padding">
  <!-- Thumbnail with Play Button -->
  <div class="video-thumbnail">
    <img src="{{ settings.thumbnail_image | img_url: 'medium' | default: 'https://via.placeholder.com/640x360?text=Video+Thumbnail' }}" 
         alt="Video Thumbnail" class="thumbnail-image" width="640" height="360">
    <button class="play-button" onclick="openVideoPopup()">â–¶</button>
  </div>
</div>

<!-- Video Popup Modal -->
<div id="videoPopup" class="video-popup">
  <div class="video-popup-content">
    <span class="close" onclick="closeVideoPopup()">&times;</span>
    {%- if section.settings.video == null and section.settings.video_url != null -%}
      {%- liquid
        assign loop = ''
        if section.settings.enable_video_looping
          assign loop = '&loop=1&playlist=' | append: video_id
        endif
      -%}
      {%- if section.settings.video_url.type == 'youtube' -%}
        <iframe
          src="https://www.youtube.com/embed/{{ video_id }}?enablejsapi=1&autoplay=1{{ loop }}"
          class="js-youtube"
          allow="autoplay; encrypted-media"
          allowfullscreen
          title="{{ section.settings.description | escape }}"
        ></iframe>
      {%- else -%}
        <iframe
          src="https://player.vimeo.com/video/{{ video_id }}?autoplay=1{{ loop }}"
          class="js-vimeo"
          allow="autoplay; encrypted-media"
          allowfullscreen
          title="{{ section.settings.description | escape }}"
        ></iframe>
      {%- endif -%}
    {%- else -%}
      {{
        section.settings.video
        | video_tag:
          image_size: '1100x',
          autoplay: true,
          loop: section.settings.enable_video_looping,
          controls: true,
          muted: false
      }}
    {%- endif -%}
  </div>
</div>

<script>
  // Open the video popup
  function openVideoPopup() {
    var popup = document.getElementById("videoPopup");
    var videoFrame = document.getElementById("videoFrame");
    var videoUrl = "{{ settings.video_url }}"; // Dynamic video URL from settings
    videoFrame.src = videoUrl;
    popup.style.display = "block";
  }

  // Close the video popup
  function closeVideoPopup() {
    var popup = document.getElementById("videoPopup");
    var videoFrame = document.getElementById("videoFrame");
    videoFrame.src = ""; // Stop video when closing
    popup.style.display = "none";
  }

  // Close the popup if the user clicks outside of the content
  window.onclick = function(event) {
    var popup = document.getElementById("videoPopup");
    if (event.target == popup) {
      closeVideoPopup();
    }
  }
</script>

<style>
  /* Style the thumbnail container */
  .video-popup-container {
    position: relative;
    display: inline-block;
  }

  .video-thumbnail {
    position: relative;
  }

  .thumbnail-image {
    width: 100%;
    height: auto;
  }

  /* Play button style */
  .play-button {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.5);
    color: white;
    border: none;
    font-size: 2rem;
    padding: 10px;
    cursor: pointer;
  }

  /* The Modal (popup) */
  .video-popup {
    display: none; /* Hidden by default */
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.7);
  }

  /* Modal content */
  .video-popup-content {
    position: relative;
    margin: 15% auto;
    background-color: #fff;
    padding: 20px;
    width: 80%;
    max-width: 800px;
  }

  /* Close button */
  .close {
    position: absolute;
    top: 10px;
    right: 20px;
    color: #000;
    font-size: 30px;
    font-weight: bold;
    cursor: pointer;
  }
</style>

{% schema %}
{
  "name": "t:sections.wpb-video-pop-up.name",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "image_picker",
      "id": "thumbnail_image",
      "label": "Thumbnail Image"
    },
    {
      "type": "video_url",
      "id": "video_url",
      "accept": ["youtube", "vimeo"],
      "default": "https://www.youtube.com/watch?v=_9VUPq3SxOc",
      "label": "t:sections.video.settings.video_url.label",
      "info": "t:sections.video.settings.video_url.info"
    },
    {
      "type": "image_picker",
      "id": "cover_image",
      "label": "t:sections.video.settings.cover_image.label"
    },
    {
      "type": "number",
      "id": "padding_top",
      "label": "Padding Top",
      "default": 20
    },
    {
      "type": "number",
      "id": "padding_bottom",
      "label": "Padding Bottom",
      "default": 20
    }
  ],
  "presets": [
    {
      "name": "t:sections.wpb-video-pop-up.presets.name"
    }
  ]
}
{% endschema %}
